window.N=function(){FB.S({M:0x47d752c095622,cookie:!0,Z:!0,version:"v2.5"});FB.I.X();g()};var h,k=document.getElementsByTagName("script")[0];document.getElementById("facebook-jssdk")||(h=document.createElement("script"),h.id="facebook-jssdk",h.src="//connect.facebook.net/en_US/sdk.js",k.parentNode.insertBefore(h,k));
$(document).ready(function(){$(function(){$('[data-toggle="tooltip"]').Y()});$("#locationBtn").click(function(){console.log("in locationBtn");var a=new google.F.J,d=$("#locationInput").H();a.P({address:d},function(a,c){c==google.F.K.L?n(a[0]):(str="Enter a valid address...",$("#locationInput").H(str))})});$("#festivalsModal").W("show.bs.modal",function(){if("undefined"!==typeof Storage){var a=sessionStorage.getItem("zoukevents");if(void 0!==a&&a&&(a=JSON.parse(a),0<a.length)){for(var d=[],b=0;b<p.length;b++){var c=
q(p[b],a);c&&d.push(c)}0<d.length&&(a='\n                            <table class="table table-condensed">\n                            <thead><th>Date</th><th>Event</th><th>Attending</th><tr></tr></thead>\n                            '+r(d),a+="</table>",$("#selectedFestivalsTable").o(a))}}})});
var t="zouk zouk+carnival zouk+time zouk+night f.i.e.l+official lambazouk zouk+lambada brazilian+zouk zouk+festival zouk+marathon zouk+family zouk+fest zouk+congress zouk+weekend zouk+salsa zouk+samba zouk+beach zouk+holiday bachaturo zouk+kizomba zouk+dance zouk+sea fall+zouk \u0437\u0443\u043a berg+zouk brazouka zoukdevils zouk+fever brasileiro+zouk zouk+fusion zouk+flow zouk+day zouk+jam zouk+danse oman+zouk international+zouk zouk+bachata carioca+zouk".split(" "),p="zouk\\s+libre.*festival prague.*zouk.*congress prague\\s+zouk\\s+marathon rio.*zouk.*congress f.i.e.l zoukmx\\s \\s*zoukfest\\s l.*a.*Zouk.*congress [^t]zouktime!|^zouktime!\\s dutch.+international.+zouk.+congr berg.*congres i'm\\s*zouk canada.*zouk".split(" "),
u=[{latitude:"48.812053039547",longitude:"2.4038419249911"},{latitude:"-22.882511415042",longitude:"-48.452376032727"},{latitude:"46.01244",longitude:"-0.28403"},{latitude:"-22.9937382",longitude:"-44.2409439"}],v=new Date,w=[],x=[],y={},z,A=0,B=[],C=0,D={};
function g(){var a=E;FB.R(function(d){"connected"===d.status?(z=d.u.w,a()):($("#bannerMsg").show(),FB.V(function(b){b.u?"connected"===b.status&&(z=b.u.w,$("#bannerMsg").f(),a()):console.log("User cancelled login or did not fully authorize.")}))})}function E(){for(var a=[],d=0;d<t.length;d++)a.push({method:"GET",c:"search?q="+t[d]+"&type=event&fields=id,name,start_time,place,attending_count,cover,description&access_token="+z});$("#searchProgressBarDiv").show();FB.a("/","POST",{b:a},F)}
function F(a){if(!a||a.error)console.log("FB.api: Error occured"),console.log(a);else{for(var d=[],b=0;b<a.length;b++)if(a[b]&&a[b].hasOwnProperty("body")&&a[b].body){var c=JSON.parse(a[b].body);G(c);if(c.hasOwnProperty("data")&&c.data)for(var e=c.data,f=0;f<e.length;f++)H(e[f])&&9E3>w.length&&(e[f].hasOwnProperty("description")&&e[f].description&&(e[f].description=null),w.push(e[f]));c.hasOwnProperty("paging")&&c.h&&(c=c.h,c.hasOwnProperty("next")&&c.next&&d.push({method:"GET",c:"search?"+c.next.split("?")[1]}))}A=
40>A?A+5:A;$("#searchProgressBar").l("width",A+"%").j("aria-valuenow",A);if(0<d.length)FB.a("/","POST",{b:d},F);else{console.log("total events "+w.length);a=[];for(d=0;d<t.length;d++)a.push({method:"GET",c:"search?q="+t[d]+"&type=page&fields=id&access_token="+z});FB.a("/","POST",{b:a},I)}}}
function I(a){if(!a||a.error)console.log("FB.api: Error occured"),console.log(a);else{for(var d=[],b=0;b<a.length;b++)if(a[b]&&a[b].hasOwnProperty("body")&&a[b].body){var c=JSON.parse(a[b].body);G(c);if(c.hasOwnProperty("data")&&c.data)for(var e=c.data,f=0;f<e.length;f++)D[e[f].id]=!0;c.hasOwnProperty("paging")&&c.h&&(c=c.h,c.hasOwnProperty("next")&&c.next&&d.push({method:"GET",c:"search?"+c.next.split("?")[1]}))}A=75>A?A+5:A;$("#searchProgressBar").l("width",A+"%").j("aria-valuenow",A);0<d.length?
FB.a("/","POST",{b:d},I):(console.log("total pages "+Object.keys(D).length),(a=J())&&FB.a("/","POST",{b:a},K))}}
function K(a){if(!a||a.error)console.log("FB.api: Error occured"),console.log(a);else{for(var d=[],d=0;d<a.length;d++)if(a[d]&&a[d].hasOwnProperty("body")&&a[d].body){var b=JSON.parse(a[d].body);G(b);if(b.hasOwnProperty("data")&&b.data)for(var b=b.data,c=0;c<b.length;c++)H(b[c])&&9E3>w.length&&(b[c].hasOwnProperty("description")&&b[c].description&&(b[c].description=null),w.push(b[c]))}A=98>A?A+1:A;$("#searchProgressBar").l("width",A+"%").j("aria-valuenow",A);if(d=J())FB.a("/","POST",{b:d},K);else{console.log("total events "+
w.length);$("#searchProgressBar").l("width","100%").j("aria-valuenow",100);$("#filterProgressBarDiv").show();A=0;a=[];for(d=0;d<p.length;d++)(b=q(p[d],w))&&a.push({method:"GET",c:b.id+"/attending?access_token="+z});0<a.length&&FB.a("/","POST",{b:a},L)}}}
function J(){var a=Object.keys(D);if(0>=a.length)return null;for(var d=45<a.length?45:a.length,b=[],c=0;c<d;c++){var e=a[c];b.push({method:"GET",c:e+"/events?fields=id,name,start_time,place,attending_count,cover,description&access_token="+z})}for(c=0;c<d;c++)e=a[c],delete D[e];return b}
function L(a){if(!a||a.error)console.log("FB.api: Error occured"),console.log(a);else{A=10>A?A+2:A;$("#filterProgressBar").l("width",A+"%").j("aria-valuenow",A);for(var d=[],b=0;b<a.length;b++)if(a[b]&&a[b].hasOwnProperty("body")&&a[b].body){var c=JSON.parse(a[b].body);G(c);if(c.hasOwnProperty("data")&&c.data)for(var e=c.data,f=0;f<e.length;f++)y.hasOwnProperty(e[f].id)||(y[e[f].id]=!0);c.hasOwnProperty("paging")&&c.h&&(c=c.h,c.hasOwnProperty("next")&&c.next&&d.push({method:"GET",c:O(c.next)}))}if(0<
d.length)FB.a("/","POST",{b:d},L);else{"undefined"!==typeof Storage&&sessionStorage.setItem("zoukattendees",Object.keys(y).length);for(a=0;a<w.length;a++)100<w[a].i&&B.push({id:w[a].id,m:{},done:!1});d=[];b=45>B.length?B.length:45;for(a=0;a<b;a++)d.push({method:"GET",c:B[a].id+"/attending?access_token="+z});FB.a("/","POST",{b:d},P)}}}
function P(a){C++;if(!a||a.error)console.log("FB.api: Error occured"),console.log(a);else{A=95>A?A+2:A;$("#filterProgressBar").l("width",A+"%").j("aria-valuenow",A);for(var d=[],b=0;b<a.length;b++)if(a[b]&&a[b].hasOwnProperty("body")&&a[b].body){var c=JSON.parse(a[b].body);G(c);if(c.hasOwnProperty("data")&&c.data)for(var e=c.data,f=0;f<e.length;f++)B[b].m.hasOwnProperty(e[f].id)||(B[b].m[e[f].id]=!0);e=!0;c.hasOwnProperty("paging")&&c.h&&(c=c.h,c.hasOwnProperty("next")&&c.next&&(d.push({method:"GET",
c:O(c.next)}),e=!1));B[b].done=e}if(20<=C){for(b=0;b<a.length;b++)B[b].done=!0;C=0;d.length=0}for(b=0;b<B.length;b++)B[b].done&&(Q(B[b].id,B[b].m),B.splice(b,1));if(0<d.length)FB.a("/","POST",{b:d},P);else if(d=[],a=45>B.length?B.length:45,0<a){for(b=0;b<a;b++)d.push({method:"GET",c:B[b].id+"/attending?access_token="+z});FB.a("/","POST",{b:d},P)}else $("#filterProgressBar").l("width","100%").j("aria-valuenow",100),0<w.length&&(d=function(a,b){return R(a.s)>R(b.s)?1:-1},w.sort(d),x.sort(d),setTimeout(function(){var a=
w,b="";if("undefined"!==typeof Storage){var c=sessionStorage.getItem("zoukattendees");void 0!==c&&c&&(b+='&nbsp; &nbsp; <span class="badge">'+c+'</span> attending <a href="#" data-toggle="modal" data-target="#festivalsModal">major festivals</a>')}c='\n        <table class="table table-condensed">\n        '+r(a);c+="</table>";$("#searchProgressBarDiv").f();$("#filterProgressBarDiv").f();$("#map").f();$("#contentNav").show();$("#evTableHeader").show();$("#evTableContent").f().o(c).v("fast");b='<span class="badge">'+
a.length+"</span> events"+b;$("#totalEvents").f().o(b).v("fast");$("#mainContent").show()},700),"undefined"!==typeof Storage&&(sessionStorage.setItem("zoukevents",JSON.stringify(w)),sessionStorage.setItem("suspectevents",JSON.stringify(x))))}}function G(a){a.hasOwnProperty("error")&&a.error&&alert("Facebook is temporarily down, try later (error: "+a.error.code+")")}
function n(a){var d=a.D.location.T(),b=a.D.location.U();if("undefined"===typeof Storage)alert("Your browser does not support this operation");else{var c=sessionStorage.getItem("zoukevents");void 0!==c&&c||console.log("No events in showEventsByAttendingInner");w=JSON.parse(c);for(var c=[],e=0;e<w.length;e++)if(w[e].hasOwnProperty("place")&&w[e].g){var f=w[e].g;f.hasOwnProperty("location")&&f.location&&(f=f.location,f.hasOwnProperty("latitude")&&f.latitude&&f.hasOwnProperty("longitude")&&f.longitude&&
(w[e].i=Math.round(S(d,b,f.latitude,f.longitude)),c.push(w[e])))}0<c.length&&(c.sort(function(a,b){return parseInt(a.i)>parseInt(b.i)?1:-1}),a='\n            <table style="margin-top: 10px;"><tr><td>\n            <button type="button" class="btn btn-default btn-sm" onclick="showEventsByTimeInner();">\n            <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span> Back\n            </button>\n            </td>\n            <td><h5 style="padding-left:20px;">Address: '+a.O+'</h5></td></tr>\n            </table>\n            <table class="table table-condensed">\n            <thead>\n            <th>Date</th>\n            <th>Event</th>\n            <th>Distance (mi)</th>\n            <tr>\n            </tr>\n            </thead>\n            ',
a+=r(c),a+="</table>",$("#map").f(),$("#evTableHeader").f(),$("#evTableContent").f().o(a).v("fast"),$("#mainContent").show())}}
function r(a){for(var d="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),b="\n        <tbody>\n        ",c=0;c<a.length;c++){var e=a[c].s.split("T")[0].split("-"),f=d[parseInt(e[1])-1],M="/images/blank.jpg";if(a[c].hasOwnProperty("cover")&&a[c].C){var m=a[c].C;m.hasOwnProperty("id")&&m.id&&(M="https://graph.facebook.com/"+m.id+"/picture?access_token="+z+"&type=thumbnail")}m="";if(a[c].hasOwnProperty("place")&&a[c].g){var l=a[c].g;l.hasOwnProperty("name")&&l.name&&(m+=l.name);l.hasOwnProperty("location")&&
l.location&&(l=l.location,l.hasOwnProperty("street")&&l.G&&(m+=", "+l.G),l.hasOwnProperty("city")&&l.A&&l.hasOwnProperty("country")&&l.B&&(m+=", "+l.A+", "+l.B))}b+="<tr><td><h5>"+f+" "+e[2]+'</h5></td>\n            <td>\n            <table>\n            <tr>\n            <td>\n            <a href="https://www.facebook.com/events/'+a[c].id+'">\n            <div id="img_inner" style=\'background-image: url("'+M+'"); width: 75px; height: 42px; background-size: 75px 42px;\' >\n            </div>\n            </a>\n            </td>\n            <td style="padding-left: 20px">\n            <a href="https://www.facebook.com/events/'+
a[c].id+'">\n            <h5 title="'+a[c].name+'" data-toggle="tooltip" data-container="body" style=\'width: 400px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 7px; margin-bottom: 6px;\'>'+a[c].name+"</h5>\n            </a>\n            <h5 class='small' title=\""+m+'" data-toggle="tooltip" data-container="body" style=\'margin-top: 3px; margin-bottom: 1px; width: 400px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis\'>'+m+"<h5>\n            </td>\n            </tr>\n            </table>\n            </td>\n            <td>"+
a[c].i+"</a></td>\n            </tr>"}return b+"\n    </tbody>\n        "}function R(a){a=a.split(/[^0-9]/);return new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5])}
function H(a){if(a&&a.hasOwnProperty("start_time")){var d=R(a.s);if(v<d||864E5>v.getTime()-d.getTime()){for(var d=!1,b=0;b<w.length;b++)a.id==w[b].id&&(d=!0);if(!d){if(a.hasOwnProperty("place")&&a.g){placeStr=JSON.stringify(a.g);if(-1!==placeStr.search(/zouk/i)&&a.hasOwnProperty("name")&&a.name&&-1===a.name.search(/zouk/i)&&a.hasOwnProperty("description")&&a.description&&-1===a.description.replace(/(?:https?|ftp):\/\/[\n\S]+/g,"").search(/zouk/i))return a.description=null,x.push(a),!1;if(a.g.hasOwnProperty("location")&&
a.g.location&&(d=a.g.location,d.hasOwnProperty("latitude")&&d.hasOwnProperty("longitude")))for(b=0;b<u.length;b++)if(d.latitude==u[b].latitude&&d.longitude==u[b].longitude)return a.description=null,x.push(a),!1}return!0}}}return!1}function q(a,d){for(var b=null,c=0,e=0;e<d.length;e++)-1!==d[e].name.search(new RegExp(a,"i"))&&d[e].i>c&&(b=d[e],c=d[e].i);b||console.log(a+" not found");return b}
function Q(a,d){if(!(d&&90>Object.keys(d).length)){for(var b=0;b<w.length&&w[b].id!=a;b++);if(b>=w.length)console.log("Not expected, event not found "+a);else{for(var c=Object.keys(d),e=0,f=0;f<c.length;f++)y.hasOwnProperty(c[f])&&e++;2>100*e/c.length&&(b=w.splice(b,1),x.splice(0,0,b[0]))}}}function O(a){a=a.split("?");var d=a[0].split("/"),b=d.length;return d[b-2]+"/"+d[b-1]+"?"+a[1]}
function S(a,d,b,c){a=Math.PI*a/180;b=Math.PI*b/180;d=Math.sin(a)*Math.sin(b)+Math.cos(a)*Math.cos(b)*Math.cos(Math.PI*(d-c)/180);d=Math.acos(d);d=180*d/Math.PI;return 69.09*d};